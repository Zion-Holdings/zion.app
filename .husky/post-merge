#!/usr/bin/env sh
. "$(dirname -- "$0")/_/husky.sh"

echo "🔄 Post-merge actions running..."

# Update dependencies if package files changed
if git diff HEAD@{1} --name-only | grep -E "package\.json|package-lock\.json" > /dev/null; then
    echo "📦 Package files changed, updating dependencies..."
    npm install
fi

# Restart automation system if needed
if [ -f "automation/universal-automation-launcher.sh" ]; then
    echo "🤖 Checking automation system after merge..."
    /bin/bash automation/universal-automation-launcher.sh status > /dev/null 2>&1 || {
        echo "🔄 Restarting automation system..."
        /bin/bash automation/universal-automation-launcher.sh restart > /dev/null 2>&1 || true
    }
fi

# Clear build cache if needed
if git diff HEAD@{1} --name-only | grep -E "next\.config\.js|tsconfig\.json|tailwind\.config\.js" > /dev/null; then
    echo "🧹 Clearing build cache..."
    rm -rf .next 2>/dev/null || true
fi

# Run type check to ensure everything is still working
echo "🔍 Running type check after merge..."
npm run type-check || {
    echo "⚠️  Type check failed after merge. Please review changes."
}

echo "✅ Post-merge actions completed" 