echo "ğŸš€ Autonomous Pre-push System Starting..."

# Set environment variables for autonomous operation
export AUTONOMOUS_MODE=true
export HUSKY_AUTOMATION=true
export AUTO_FIX_ENABLED=true

# Run comprehensive pre-push checks
echo "ğŸ“‹ Running comprehensive pre-push checks..."

# 1. Final lint check
echo "ğŸ” Final lint check..."
npm run lint || {
    echo "âŒ Linting failed"
    exit 1
}

# 2. Type checking
echo "ğŸ” Type checking..."
npm run type-check || {
    echo "âŒ Type checking failed"
    exit 1
}

# 3. Run comprehensive tests with coverage
echo "ğŸ§ª Running comprehensive tests..."
npm test -- --coverage || {
    echo "âŒ Tests failed"
    exit 1
}

# 4. Bundle size analysis
echo "ğŸ“¦ Bundle size analysis..."
npm run build -- --analyze || {
    echo "âš ï¸  Bundle analysis failed, but continuing..."
}

# 5. High severity security audit
echo "ğŸ”’ High severity security audit..."
npm audit --audit-level=high || {
    echo "âŒ High severity vulnerabilities found"
    exit 1
}

# 6. Performance checks
echo "âš¡ Performance checks..."
node automation/performance/performance-check.js || {
    echo "âš ï¸  Performance checks failed, but continuing..."
}

# 7. Sensitive data check
echo "ğŸ” Sensitive data check..."
node automation/security/check-sensitive-data.js || {
    echo "âŒ Sensitive data found"
    exit 1
}

# 8. Autonomous deployment preparation
echo "ğŸ¤– Preparing for deployment..."
node automation/enhanced-automation-system.js pre-push || {
    echo "âš ï¸  Deployment preparation failed, but continuing..."
}

echo "âœ… Pre-push checks completed successfully!"