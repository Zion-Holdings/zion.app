#!/usr/bin/env sh

echo "ðŸš€ Running pre-push checks..."

# Run full test suite
echo "ðŸ§ª Running full test suite..."
npm run test:all || {
    echo "âŒ Test suite failed. Please fix the issues before pushing."
    exit 1
}

# Check if automation system is running properly
if [ -f "automation/universal-automation-launcher.sh" ]; then
    echo "ðŸ¤– Checking automation system..."
    /bin/bash automation/universal-automation-launcher.sh status > /dev/null 2>&1 || {
        echo "âš ï¸  Warning: Automation system may have issues"
    }
fi

# Check for sensitive data in commits
echo "ðŸ”’ Checking for sensitive data..."
if git diff --cached | grep -i -E "(password|secret|key|token|api_key)" > /dev/null; then
    echo "âš ï¸  Warning: Potential sensitive data detected in commit"
    echo "   Please review before pushing"
fi

# Check for large files
echo "ðŸ“¦ Checking for large files..."
if git diff --cached --name-only | xargs ls -la 2>/dev/null | awk '{if($5 > 10485760) print "âš ï¸  Large file detected: " $9 " (" $5 " bytes)"}' | head -5; then
    echo "âš ï¸  Large files detected. Consider using .gitignore or git-lfs"
fi

# Backup important files before push
echo "ðŸ’¾ Creating backup of important files..."
mkdir -p .git/backup 2>/dev/null || true
cp package.json .git/backup/package.json.backup 2>/dev/null || true
cp next.config.js .git/backup/next.config.js.backup 2>/dev/null || true

echo "âœ… Pre-push checks passed" 