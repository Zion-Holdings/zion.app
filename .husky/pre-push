echo "🚀 Autonomous Pre-push System Starting..."

# Set environment variables for autonomous operation
export AUTONOMOUS_MODE=true
export HUSKY_AUTOMATION=true
export AUTO_FIX_ENABLED=true

# Run comprehensive pre-push checks
echo "📋 Running comprehensive pre-push checks..."

# 1. Final lint check
echo "🔍 Final lint check..."
npm run lint || {
    echo "❌ Linting failed"
    exit 1
}

# 2. Type checking
echo "🔍 Type checking..."
npm run type-check || {
    echo "❌ Type checking failed"
    exit 1
}

# 3. Run comprehensive tests with coverage
echo "🧪 Running comprehensive tests..."
npm test -- --coverage || {
    echo "❌ Tests failed"
    exit 1
}

# 4. Bundle size analysis
echo "📦 Bundle size analysis..."
npm run build -- --analyze || {
    echo "⚠️  Bundle analysis failed, but continuing..."
}

# 5. High severity security audit
echo "🔒 High severity security audit..."
npm audit --audit-level=high || {
    echo "❌ High severity vulnerabilities found"
    exit 1
}

# 6. Performance checks
echo "⚡ Performance checks..."
node automation/performance/performance-check.js || {
    echo "⚠️  Performance checks failed, but continuing..."
}

# 7. Sensitive data check
echo "🔐 Sensitive data check..."
node automation/security/check-sensitive-data.js || {
    echo "❌ Sensitive data found"
    exit 1
}

# 8. Autonomous deployment preparation
echo "🤖 Preparing for deployment..."
node automation/enhanced-automation-system.js pre-push || {
    echo "⚠️  Deployment preparation failed, but continuing..."
}

echo "✅ Pre-push checks completed successfully!"