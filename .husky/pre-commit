#!/usr/bin/env sh

echo "üîç Running pre-commit checks..."

# Run linting
echo "üìù Running ESLint..."
npm run lint || {
    echo "‚ùå ESLint failed. Please fix the issues before committing."
    exit 1
}

# Run type checking
echo "üîç Running TypeScript type check..."
npm run type-check || {
    echo "‚ùå TypeScript type check failed. Please fix the issues before committing."
    exit 1
}

# Check for uncommitted changes in package files
if git diff --cached --name-only | grep -E "package\.json|package-lock\.json" > /dev/null; then
    echo "üì¶ Package files changed, running npm install..."
    npm install
fi

# Check for automation system conflicts
if [ -f "automation/universal-automation-launcher.sh" ]; then
    echo "ü§ñ Checking automation system status..."
    /bin/bash automation/universal-automation-launcher.sh status > /dev/null 2>&1 || {
        echo "‚ö†Ô∏è  Warning: Automation system may have issues"
    }
fi

echo "‚úÖ Pre-commit checks passed"
