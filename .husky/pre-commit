echo "ğŸš€ Autonomous Pre-commit System Starting..."

# Set environment variables for autonomous operation
export AUTONOMOUS_MODE=true
export HUSKY_AUTOMATION=true
export AUTO_FIX_ENABLED=true

# Run comprehensive pre-commit checks
echo "ğŸ“‹ Running comprehensive pre-commit checks..."

# 1. Lint and auto-fix
echo "ğŸ” Linting and auto-fixing..."
npm run lint || {
    echo "âš ï¸  Linting issues found, attempting auto-fix..."
    npm run lint -- --fix || {
        echo "âŒ Linting failed and could not be auto-fixed"
        exit 1
    }
}

# 2. Type checking
echo "ğŸ” Type checking..."
npm run type-check || {
    echo "âŒ Type checking failed"
    exit 1
}

# 3. Format code
echo "ğŸ¨ Formatting code..."
npm run format || {
    echo "âŒ Code formatting failed"
    exit 1
}

# 4. Run tests
echo "ğŸ§ª Running tests..."
npm test || {
    echo "âŒ Tests failed"
    exit 1
}

# 5. Check for security vulnerabilities
echo "ğŸ”’ Security check..."
npm audit --audit-level=moderate || {
    echo "âš ï¸  Security vulnerabilities found, but continuing..."
}

# 6. Build check
echo "ğŸ—ï¸  Build check..."
npm run build || {
    echo "âŒ Build failed"
    exit 1
}

# 7. Autonomous improvements
echo "ğŸ¤– Running autonomous improvements..."
node automation/enhanced-automation-system.js pre-commit || {
    echo "âš ï¸  Autonomous improvements failed, but continuing..."
}

echo "âœ… Pre-commit checks completed successfully!"