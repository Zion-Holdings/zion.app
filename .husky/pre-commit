#!/usr/bin/env sh
set -e

echo "üîç Running pre-commit checks..."

# Run lint-staged to format/lint staged files
if [ -x "./node_modules/.bin/lint-staged" ]; then
  npm run -s lint:staged || {
    echo "‚ùå lint-staged failed. Please fix issues before committing."
    exit 1
  }
else
  echo "‚ÑπÔ∏è  Skipping lint-staged (not installed). Run 'npm install' to enable."
fi

# Skip type-check if tsc is not available locally
if [ -x "./node_modules/.bin/tsc" ]; then
  npm run -s type-check || {
    echo "‚ùå TypeScript type check failed. Please fix issues before committing."
    exit 1
  }
else
  echo "‚ÑπÔ∏è  Skipping type-check (tsc not found). Run 'npm install' to enable."
fi

# Deletion guard to preserve files unless explicitly allowed
sh ./scripts/prevent-deletion.sh

echo "‚úÖ Pre-commit checks passed"
