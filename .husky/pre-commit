#!/usr/bin/env sh
set -e

echo "üîç Running pre-commit checks..."

# TypeScript type check if available
if [ -x "./node_modules/.bin/tsc" ]; then
  npm run -s type-check || {
    echo "‚ùå TypeScript type check failed. Please fix issues before committing."
    exit 1
  }
else
  echo "‚ÑπÔ∏è  Skipping type-check (tsc not found). Run 'npm install' to enable."
fi

# Lint staged files
if [ -x "./node_modules/.bin/lint-staged" ]; then
  npx --no-install lint-staged || {
    echo "‚ùå Linting staged files failed."
    exit 1
  }
else
  echo "‚ÑπÔ∏è  Skipping lint-staged (not installed)."
fi

# Deletion guard to preserve files unless explicitly allowed
sh ./scripts/prevent-deletion.sh

echo "‚úÖ Pre-commit checks passed"
