#!/usr/bin/env sh
set -e

echo "ðŸ”„ Pre-rebase checks running..."

# Check if there are uncommitted changes
if ! git diff-index --quiet HEAD --; then
    echo "âš ï¸  Warning: You have uncommitted changes"
    echo "   Consider committing or stashing them before rebasing"
    echo "   Use 'git stash' to temporarily save changes"
    echo "   Use 'git commit' to commit changes"
    echo ""
    echo "â„¹ï¸ Continuing with rebase automatically (non-interactive hook)"
fi

# Prevent starting a rebase when conflicts exist
if bash ./scripts/check-merge-conflicts.sh >/dev/null 2>&1; then
  :
else
  echo "âŒ Resolve current merge conflicts before rebasing."
  exit 1
fi

# Backup important configuration files
echo "ðŸ’¾ Backing up important files..."
mkdir -p .git/backup 2>/dev/null || true
cp package.json .git/backup/package.json.backup 2>/dev/null || true
cp next.config.js .git/backup/next.config.js.backup 2>/dev/null || true
cp tsconfig.json .git/backup/tsconfig.json.backup 2>/dev/null || true

# Check automation status
if [ -f "automation/universal-automation-launcher.sh" ]; then
    echo "ðŸ¤– Checking automation status..."
    /bin/bash automation/universal-automation-launcher.sh status || true
fi

echo "âœ… Pre-rebase checks completed" 