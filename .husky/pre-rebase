#!/usr/bin/env sh

echo "🔄 Pre-rebase checks running..."

# Check if there are uncommitted changes
if ! git diff-index --quiet HEAD --; then
    echo "⚠️  Warning: You have uncommitted changes"
    echo "   Consider committing or stashing them before rebasing"
    echo "   Use 'git stash' to temporarily save changes"
    echo "   Use 'git commit' to commit changes"
    echo ""
    read -p "Continue with rebase anyway? (y/N): " -n 1 -r
    echo
    if [[ ! $REPLY =~ ^[Yy]$ ]]; then
        echo "❌ Rebase cancelled"
        exit 1
    fi
fi

# Backup important configuration files
echo "💾 Backing up important files..."
mkdir -p .git/backup 2>/dev/null || true
cp package.json .git/backup/package.json.backup 2>/dev/null || true
cp next.config.js .git/backup/next.config.js.backup 2>/dev/null || true
cp tsconfig.json .git/backup/tsconfig.json.backup 2>/dev/null || true

# Check automation status
if [ -f "automation/universal-automation-launcher.sh" ]; then
    echo "🤖 Checking automation status..."
    /bin/bash automation/universal-automation-launcher.sh status || true
fi

echo "✅ Pre-rebase checks completed" 