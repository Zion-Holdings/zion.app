import fs from 'fs';
import path from 'path';
import Link from 'next/link';
import Head from 'next/head';

type UpdatePage = {
	fileName: string;
	route: string;
	label: string;
};

export async function getStaticProps() {
	const updatesDir = path.join(process.cwd(), 'pages', 'reports', 'updates');
	let updates: UpdatePage[] = [];
	try {
		const files = fs.readdirSync(updatesDir)
			.filter((f) => f.endsWith('.tsx'))
			.sort()
			.reverse()
			.slice(0, 12);
		updates = files.map((fileName) => {
			const base = fileName.replace(/\.tsx$/, '');
			return {
				fileName,
				route: `/reports/updates/${base}`,
				label: base.replace(/update-/i, 'Update — ').replace(/-/g, ': '),
			};
		});
	} catch {
		updates = [];
	}
	return { props: { updates } };
}

export default function ReportsIndex({ updates }: { updates: UpdatePage[] }) {
	return (
		<>
			<Head>
				<title>Reports & Analytics — Zion Tech Group</title>
				<meta name="description" content="Latest autonomous updates, reports, and analytics from Zion Tech Group." />
			</Head>
			<div className="min-h-screen bg-gradient-to-br from-indigo-950 via-purple-950 to-slate-950 text-white">
				<main className="container mx-auto px-6 py-12">
					<h1 className="text-4xl font-extrabold mb-8">Reports & Analytics</h1>
					<p className="text-white/80 mb-8">Latest autonomous updates generated by our platform.</p>
					<div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
						{updates.map((u) => (
							<Link key={u.route} href={u.route} className="group relative overflow-hidden rounded-2xl border border-white/10 bg-gradient-to-br from-white/10 to-white/5 p-6 backdrop-blur-xl hover:border-cyan-400/30">
								<h3 className="text-lg font-semibold">{u.label}</h3>
								<div className="mt-3 inline-flex items-center gap-1 text-xs text-cyan-300/90">Open <span aria-hidden>→</span></div>
							</Link>
						))}
						{updates.length === 0 && (
							<p className="text-white/70">No reports found.</p>
						)}
					</div>
				</main>
			</div>
		</>
	);
}

