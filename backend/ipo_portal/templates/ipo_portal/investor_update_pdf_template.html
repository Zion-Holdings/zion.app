<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8" />
        <title>Investor Update: {{ update.title }}</title>
        <style>
      @page {
        size: A4;
        margin: 1.5cm;
      }
      body {
        font-family: 'Helvetica Neue', Helvetica, Arial, sans-serif;
        color: #333;
        line-height: 1.6;
      }
      .header {
        text-align: center;
        margin-bottom: 30px;
        border-bottom: 2px solid #0056b3; /* Example primary color */
        padding-bottom: 10px;
      }
      .header h1 {
        margin: 0;
        font-size: 24px;
        color: #0056b3;
      }
      .header .company-logo {
        /* Assuming you have a logo */
        /* position: absolute; top: 1.5cm; left: 1.5cm; height: 50px; */
        /* For simplicity, not adding actual image path now */
        font-style: italic;
        color: #777;
        font-size: 12px;
        text-align: left; /* Or right */
      }
      .update-meta {
        margin-bottom: 20px;
        font-size: 0.9em;
        color: #555;
      }
      .update-meta p {
        margin: 2px 0;
      }
      .summary {
        margin-bottom: 20px;
        text-align: justify;
      }
      .kpis-snapshot {
        margin-top: 25px;
        border-top: 1px solid #eee;
        padding-top: 15px;
      }
      .kpis-snapshot h3 {
        font-size: 18px;
        color: #0056b3;
        margin-bottom: 10px;
      }
      .kpis-snapshot table {
        width: 100%;
        border-collapse: collapse;
      }
      .kpis-snapshot th,
      .kpis-snapshot td {
        border: 1px solid #ddd;
        padding: 8px;
        text-align: left;
      }
      .kpis-snapshot th {
        background-color: #f7f7f7;
        font-weight: bold;
      }
      .kpis-snapshot pre {
        /* If kpis_snapshot is rendered as raw JSON */
        background-color: #f0f0f0;
        padding: 10px;
        border-radius: 4px;
        white-space: pre-wrap; /* Ensure JSON wraps */
        word-wrap: break-word;
      }
      .footer {
        position: fixed;
        bottom: 1cm;
        left: 0;
        right: 0;
        text-align: center;
        font-size: 0.8em;
        color: #777;
        border-top: 1px solid #eee;
        padding-top: 5px;
      }
      .confidential {
        text-align: center;
        color: red;
        font-weight: bold;
        margin-top: 30px;
        font-size: 0.9em;
      }
        </style>
    </head>
    <body>
        <div class="header">
            <div class="company-logo">[Your Company Logo Here] - Confidential</div>
            <h1>Investor Update</h1>
        </div>
        <div class="update-meta">
            <h2>{{ update.title }}</h2>
            <p>
                <strong>Publication Date:</strong> {{ update.publication_date|date:"F j,
                Y" }}
            </p>
            {% if update.author %}
                <p>
                    <strong>Author:</strong> {{
                    update.author.get_full_name|default:update.author.username }}
                </p>
            {% endif %}
        </div>
        <div class="summary">
            <h3>Summary</h3>
            {{ update.summary|linebreaksbr }} {# Use linebreaksbr for text from
      TextField #}
        </div>
        {% if update.kpis_snapshot %}
            <div class="kpis-snapshot">
                <h3>KPI Snapshot</h3>
                {% if update.kpis_snapshot|is_dict %}
                    {# Check if it's a dict to try table
      formatting #}
                    <table>
                        <thead>
                            <tr>
                                <th>Metric</th>
                                <th>Value</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for key, value in update.kpis_snapshot.items %}
                                <tr>
                                    <td>{{ key|capfirst }}</td>
                                    <td>{{ value }}</td>
                                </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                {% else %}
                    <pre>{{ update.kpis_snapshot }}</pre>
                    {# Fallback for non-dict JSON or simple string #}
                {% endif %}
            </div>
        {% endif %}
        <div class="confidential">CONFIDENTIAL - FOR INTERNAL AND AUTHORIZED INVESTOR USE ONLY</div>
        <div class="footer">
            Page <span class="page-number"></span> of <span class="page-count"></span>
            {# WeasyPrint automatically handles page numbers if CSS is set up, e.g.
using content: counter(page) #} {# For simplicity, this template uses
      basic placeholders that might not auto-fill without more CSS #}
        </div>
    </body>
</html>
{# Custom filter (not used here, but example if needed in Django template
rendering before WeasyPrint) #} {# {% filter is_dict kpi_data %} def
is_dict_filter(value): return isinstance(value, dict) {% endfilter %} #}
