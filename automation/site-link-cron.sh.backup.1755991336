<<<<<<< HEAD
#!/bin/bash
set -euo pipefail
DIR="$(cd "$(dirname "$0")" && pwd)"
LOG_DIR="$DIR/logs"
mkdir -p "$LOG_DIR"
LOG_FILE="$LOG_DIR/site-link-cron.log"
PID_FILE="$LOG_DIR/site-link-cron.pid"

run_once(){
  echo "[$(date -u +%FT%TZ)] üîó Site link cycle" | tee -a "$LOG_FILE"
  node "$DIR/site-link-orchestrator.cjs" once || true
}

case "${1:-start}" in
  start)
    echo "[$(date -u +%FT%TZ)] üöÄ Starting site link cron" | tee -a "$LOG_FILE"
    ( while true; do run_once; sleep 1800; done ) & echo $! > "$PID_FILE"
    ;;
  stop)
    if [ -f "$PID_FILE" ]; then
      kill "$(cat "$PID_FILE")" || true
      rm -f "$PID_FILE"
      echo "[$(date -u +%FT%TZ)] üõë Stopped" | tee -a "$LOG_FILE"
    else
      echo "[$(date -u +%FT%TZ)] ‚ÑπÔ∏è Not running" | tee -a "$LOG_FILE"
    fi
    ;;
  status)
    if [ -f "$PID_FILE" ] && ps -p "$(cat "$PID_FILE")" >/dev/null 2>&1; then
      echo "[$(date -u +%FT%TZ)] ‚úÖ Running (PID $(cat "$PID_FILE"))" | tee -a "$LOG_FILE"
    else
      echo "[$(date -u +%FT%TZ)] ‚ùå Not running" | tee -a "$LOG_FILE"
    fi
    ;;
  run)
    run_once ;;
  *)
    echo "Usage: $0 {start|stop|status|run}" ; exit 1 ;;
 esac

=======
#!/usr/bin/env bash
set -euo pipefail

INTERVAL_SECONDS="${LINK_CRON_INTERVAL_SECONDS:-900}" # default 15 minutes
RUNS="${CRON_RUNS:-0}" # 0 = infinite

run_once() {
  echo "[site-link-cron] running at $(date -Is)"
  node automation/site-link-orchestrator.cjs || true
}

if [[ "$RUNS" -gt 0 ]]; then
  for ((i=1; i<=RUNS; i++)); do
    run_once
    if [[ "$i" -lt "$RUNS" ]]; then sleep "$INTERVAL_SECONDS"; fi
  done
else
  while true; do
    run_once
    sleep "$INTERVAL_SECONDS"
  done
fi
>>>>>>> origin/cursor/crawl-and-fix-site-links-and-pages-ed4d
