<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Zion App - Intelligent Automation Dashboard</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: #333;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }

        .header {
            text-align: center;
            margin-bottom: 30px;
            color: white;
        }

        .header h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }

        .header p {
            font-size: 1.1rem;
            opacity: 0.9;
        }

        .status-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .status-card {
            background: white;
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }

        .status-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 15px 40px rgba(0,0,0,0.15);
        }

        .status-card.running {
            border-left: 5px solid #4CAF50;
        }

        .status-card.stopped {
            border-left: 5px solid #f44336;
        }

        .status-card.starting {
            border-left: 5px solid #ff9800;
        }

        .status-card.failed {
            border-left: 5px solid #9c27b0;
        }

        .card-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .card-title {
            font-size: 1.3rem;
            font-weight: 600;
            color: #333;
        }

        .status-indicator {
            padding: 5px 12px;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: 600;
            text-transform: uppercase;
        }

        .status-indicator.running {
            background: #e8f5e8;
            color: #4CAF50;
        }

        .status-indicator.stopped {
            background: #ffebee;
            color: #f44336;
        }

        .status-indicator.starting {
            background: #fff3e0;
            color: #ff9800;
        }

        .status-indicator.failed {
            background: #f3e5f5;
            color: #9c27b0;
        }

        .metrics {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
            margin-bottom: 20px;
        }

        .metric {
            text-align: center;
            padding: 15px;
            background: #f8f9fa;
            border-radius: 10px;
        }

        .metric-value {
            font-size: 1.5rem;
            font-weight: 700;
            margin-bottom: 5px;
        }

        .metric-label {
            font-size: 0.8rem;
            color: #666;
            text-transform: uppercase;
        }

        .health-bar {
            width: 100%;
            height: 8px;
            background: #e0e0e0;
            border-radius: 4px;
            overflow: hidden;
            margin-bottom: 15px;
        }

        .health-fill {
            height: 100%;
            transition: width 0.3s ease;
        }

        .health-fill.excellent {
            background: #4CAF50;
        }

        .health-fill.good {
            background: #8BC34A;
        }

        .health-fill.warning {
            background: #ff9800;
        }

        .health-fill.critical {
            background: #f44336;
        }

        .actions {
            display: flex;
            gap: 10px;
        }

        .btn {
            padding: 8px 16px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 0.9rem;
            font-weight: 500;
            transition: all 0.3s ease;
            flex: 1;
        }

        .btn-primary {
            background: #2196F3;
            color: white;
        }

        .btn-primary:hover {
            background: #1976D2;
        }

        .btn-success {
            background: #4CAF50;
            color: white;
        }

        .btn-success:hover {
            background: #388E3C;
        }

        .btn-warning {
            background: #ff9800;
            color: white;
        }

        .btn-warning:hover {
            background: #f57c00;
        }

        .btn-danger {
            background: #f44336;
            color: white;
        }

        .btn-danger:hover {
            background: #d32f2f;
        }

        .overview-section {
            background: white;
            border-radius: 15px;
            padding: 25px;
            margin-bottom: 30px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
        }

        .overview-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
        }

        .overview-item {
            text-align: center;
            padding: 20px;
            background: #f8f9fa;
            border-radius: 10px;
        }

        .overview-number {
            font-size: 2rem;
            font-weight: 700;
            margin-bottom: 5px;
        }

        .overview-label {
            font-size: 0.9rem;
            color: #666;
            text-transform: uppercase;
        }

        .logs-section {
            background: white;
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
        }

        .logs-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .logs-title {
            font-size: 1.3rem;
            font-weight: 600;
        }

        .logs-container {
            background: #1e1e1e;
            color: #fff;
            padding: 20px;
            border-radius: 10px;
            height: 300px;
            overflow-y: auto;
            font-family: 'Courier New', monospace;
            font-size: 0.9rem;
        }

        .log-entry {
            margin-bottom: 5px;
            padding: 5px 0;
            border-bottom: 1px solid #333;
        }

        .log-entry.info {
            color: #4CAF50;
        }

        .log-entry.warning {
            color: #ff9800;
        }

        .log-entry.error {
            color: #f44336;
        }

        .log-entry.debug {
            color: #2196F3;
        }

        .refresh-btn {
            background: #2196F3;
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 0.9rem;
        }

        .refresh-btn:hover {
            background: #1976D2;
        }

        .connection-status {
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 10px 15px;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: 600;
            z-index: 1000;
        }

        .connection-status.connected {
            background: #e8f5e8;
            color: #4CAF50;
        }

        .connection-status.disconnected {
            background: #ffebee;
            color: #f44336;
        }

        @media (max-width: 768px) {
            .container {
                padding: 10px;
            }

            .header h1 {
                font-size: 2rem;
            }

            .status-grid {
                grid-template-columns: 1fr;
            }

            .metrics {
                grid-template-columns: 1fr;
            }

            .actions {
                flex-direction: column;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>🤖 Zion App Automation Dashboard</h1>
            <p>Intelligent Automation Orchestrator & Infinite Improvement Loop</p>
        </div>

        <div class="connection-status" id="connectionStatus">
            Connecting...
        </div>

        <div class="overview-section">
            <h2 style="margin-bottom: 20px; color: #333;">📊 System Overview</h2>
            <div class="overview-grid">
                <div class="overview-item">
                    <div class="overview-number" id="totalSystems">0</div>
                    <div class="overview-label">Total Systems</div>
                </div>
                <div class="overview-item">
                    <div class="overview-number" id="runningSystems">0</div>
                    <div class="overview-label">Running</div>
                </div>
                <div class="overview-item">
                    <div class="overview-number" id="totalTasks">0</div>
                    <div class="overview-label">Total Tasks</div>
                </div>
                <div class="overview-number" id="successRate">0%</div>
                <div class="overview-label">Success Rate</div>
                </div>
                <div class="overview-item">
                    <div class="overview-number" id="uptime">0h</div>
                    <div class="overview-label">Uptime</div>
                </div>
                <div class="overview-item">
                    <div class="overview-number" id="activeConflicts">0</div>
                    <div class="overview-label">Active Conflicts</div>
                </div>
            </div>
        </div>

        <div class="status-grid" id="statusGrid">
            <!-- Automation system cards will be populated here -->
        </div>

        <div class="logs-section">
            <div class="logs-header">
                <div class="logs-title">📝 Real-time Logs</div>
                <button class="refresh-btn" onclick="clearLogs()">Clear Logs</button>
            </div>
            <div class="logs-container" id="logsContainer">
                <div class="log-entry info">🚀 Dashboard initialized...</div>
                <div class="log-entry info">🔌 Connecting to automation systems...</div>
            </div>
        </div>
    </div>

    <script src="https://cdn.socket.io/4.7.2/socket.io.min.js"></script>
    <script>
        class AutomationDashboard {
            constructor() {
                this.socket = null;
                this.systems = new Map();
                this.logs = [];
                this.maxLogs = 100;
                this.init();
            }

            init() {
                this.connectWebSocket();
                this.loadInitialData();
                this.startPolling();
            }

            connectWebSocket() {
                // Try to connect to orchestrator first
                this.socket = io('http://localhost:3004');
                
                this.socket.on('connect', () => {
                    this.updateConnectionStatus(true);
                    this.addLog('Connected to Intelligent Automation Orchestrator', 'info');
                });

                this.socket.on('disconnect', () => {
                    this.updateConnectionStatus(false);
                    this.addLog('Disconnected from orchestrator', 'warning');
                });

                this.socket.on('orchestratorStatus', (data) => {
                    this.updateOverview(data);
                });

                this.socket.on('systemUpdate', (data) => {
                    this.updateSystem(data);
                });

                this.socket.on('metricsUpdate', (data) => {
                    this.updateMetrics(data);
                });

                // Also connect to individual systems
                this.connectToSystems();
            }

            connectToSystems() {
                const systemPorts = {
                    'autonomous': 3001,
                    'infinite-improvement': 3002,
                    'enhanced-improvement': 3003,
                    'continuous-improvement': 3005
                };

                for (const [name, port] of Object.entries(systemPorts)) {
                    try {
                        const systemSocket = io(`http://localhost:${port}`);
                        
                        systemSocket.on('connect', () => {
                            this.addLog(`Connected to ${name} system`, 'info');
                        });

                        systemSocket.on('disconnect', () => {
                            this.addLog(`Disconnected from ${name} system`, 'warning');
                        });

                        systemSocket.on('statusUpdate', (data) => {
                            this.updateSystem({ name, ...data });
                        });
                    } catch (error) {
                        this.addLog(`Failed to connect to ${name}: ${error.message}`, 'error');
                    }
                }
            }

            async loadInitialData() {
                try {
                    // Load orchestrator data
                    const orchestratorResponse = await fetch('http://localhost:3004/health');
                    if (orchestratorResponse.ok) {
                        const data = await orchestratorResponse.json();
                        this.updateOverview(data);
                    }

                    // Load individual system data
                    await this.loadSystemData();
                } catch (error) {
                    this.addLog(`Failed to load initial data: ${error.message}`, 'error');
                }
            }

            async loadSystemData() {
                const systems = [
                    { name: 'Autonomous System', port: 3001, script: 'autonomous-system.js' },
                    { name: 'Infinite Improvement Loop', port: 3002, script: 'infinite-improvement-loop.js' },
                    { name: 'Enhanced Infinite Improvement', port: 3003, script: 'enhanced-infinite-improvement.js' },
                    { name: 'Continuous Improvement', port: 3005, script: 'continuous-improvement/index.js' }
                ];

                for (const system of systems) {
                    try {
                        const response = await fetch(`http://localhost:${system.port}/health`);
                        if (response.ok) {
                            const data = await response.json();
                            this.updateSystem({
                                name: system.name,
                                status: 'running',
                                health: data.status === 'healthy' ? 100 : 50,
                                performance: data.performance || 0,
                                lastActivity: Date.now()
                            });
                        } else {
                            this.updateSystem({
                                name: system.name,
                                status: 'stopped',
                                health: 0,
                                performance: 0,
                                lastActivity: null
                            });
                        }
                    } catch (error) {
                        this.updateSystem({
                            name: system.name,
                            status: 'failed',
                            health: 0,
                            performance: 0,
                            lastActivity: null
                        });
                    }
                }
            }

            startPolling() {
                // Poll for updates every 10 seconds
                setInterval(() => {
                    this.loadSystemData();
                }, 10000);
            }

            updateConnectionStatus(connected) {
                const statusElement = document.getElementById('connectionStatus');
                statusElement.textContent = connected ? 'Connected' : 'Disconnected';
                statusElement.className = `connection-status ${connected ? 'connected' : 'disconnected'}`;
            }

            updateOverview(data) {
                if (data.systems) {
                    document.getElementById('totalSystems').textContent = data.systems.length;
                    document.getElementById('runningSystems').textContent = 
                        data.systems.filter(s => s.status === 'running').length;
                }

                if (data.totalTasks !== undefined) {
                    document.getElementById('totalTasks').textContent = data.totalTasks;
                }

                if (data.successRate !== undefined) {
                    document.getElementById('successRate').textContent = `${data.successRate}%`;
                }

                if (data.uptime !== undefined) {
                    const hours = Math.floor(data.uptime / 3600000);
                    document.getElementById('uptime').textContent = `${hours}h`;
                }

                if (data.conflicts) {
                    document.getElementById('activeConflicts').textContent = data.conflicts.length;
                }
            }

            updateSystem(data) {
                this.systems.set(data.name, data);
                this.renderSystemCard(data);
                this.updateOverviewFromSystems();
            }

            updateSystem(name, data) {
                const systemData = { name, ...data };
                this.systems.set(name, systemData);
                this.renderSystemCard(systemData);
                this.updateOverviewFromSystems();
            }

            updateOverviewFromSystems() {
                const systems = Array.from(this.systems.values());
                document.getElementById('totalSystems').textContent = systems.length;
                document.getElementById('runningSystems').textContent = 
                    systems.filter(s => s.status === 'running').length;
            }

            renderSystemCard(system) {
                let card = document.getElementById(`card-${system.name.replace(/\s+/g, '-')}`);
                
                if (!card) {
                    card = this.createSystemCard(system);
                    document.getElementById('statusGrid').appendChild(card);
                } else {
                    this.updateSystemCard(card, system);
                }
            }

            createSystemCard(system) {
                const card = document.createElement('div');
                card.id = `card-${system.name.replace(/\s+/g, '-')}`;
                card.className = `status-card ${system.status}`;
                
                card.innerHTML = `
                    <div class="card-header">
                        <div class="card-title">${system.name}</div>
                        <div class="status-indicator ${system.status}">${system.status}</div>
                    </div>
                    <div class="health-bar">
                        <div class="health-fill ${this.getHealthClass(system.health)}" style="width: ${system.health}%"></div>
                    </div>
                    <div class="metrics">
                        <div class="metric">
                            <div class="metric-value">${system.health}%</div>
                            <div class="metric-label">Health</div>
                        </div>
                        <div class="metric">
                            <div class="metric-value">${system.performance}%</div>
                            <div class="metric-label">Performance</div>
                        </div>
                    </div>
                    <div class="actions">
                        <button class="btn btn-success" onclick="dashboard.startSystem('${system.name}')">Start</button>
                        <button class="btn btn-warning" onclick="dashboard.restartSystem('${system.name}')">Restart</button>
                        <button class="btn btn-danger" onclick="dashboard.stopSystem('${system.name}')">Stop</button>
                    </div>
                `;
                
                return card;
            }

            updateSystemCard(card, system) {
                card.className = `status-card ${system.status}`;
                
                const statusIndicator = card.querySelector('.status-indicator');
                statusIndicator.textContent = system.status;
                statusIndicator.className = `status-indicator ${system.status}`;
                
                const healthFill = card.querySelector('.health-fill');
                healthFill.style.width = `${system.health}%`;
                healthFill.className = `health-fill ${this.getHealthClass(system.health)}`;
                
                const healthValue = card.querySelector('.metric-value');
                healthValue.textContent = `${system.health}%`;
                
                const performanceValue = card.querySelectorAll('.metric-value')[1];
                performanceValue.textContent = `${system.performance}%`;
            }

            getHealthClass(health) {
                if (health >= 90) return 'excellent';
                if (health >= 70) return 'good';
                if (health >= 50) return 'warning';
                return 'critical';
            }

            addLog(message, level = 'info') {
                const timestamp = new Date().toLocaleTimeString();
                const logEntry = document.createElement('div');
                logEntry.className = `log-entry ${level}`;
                logEntry.textContent = `[${timestamp}] ${message}`;
                
                const logsContainer = document.getElementById('logsContainer');
                logsContainer.appendChild(logEntry);
                
                // Keep only the last maxLogs entries
                while (logsContainer.children.length > this.maxLogs) {
                    logsContainer.removeChild(logsContainer.firstChild);
                }
                
                // Auto-scroll to bottom
                logsContainer.scrollTop = logsContainer.scrollHeight;
            }

            async startSystem(name) {
                try {
                    const response = await fetch('http://localhost:3004/orchestrate', {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({ action: 'start', target: name })
                    });
                    
                    if (response.ok) {
                        this.addLog(`Started ${name}`, 'info');
                    } else {
                        this.addLog(`Failed to start ${name}`, 'error');
                    }
                } catch (error) {
                    this.addLog(`Error starting ${name}: ${error.message}`, 'error');
                }
            }

            async stopSystem(name) {
                try {
                    const response = await fetch('http://localhost:3004/orchestrate', {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({ action: 'stop', target: name })
                    });
                    
                    if (response.ok) {
                        this.addLog(`Stopped ${name}`, 'info');
                    } else {
                        this.addLog(`Failed to stop ${name}`, 'error');
                    }
                } catch (error) {
                    this.addLog(`Error stopping ${name}: ${error.message}`, 'error');
                }
            }

            async restartSystem(name) {
                try {
                    const response = await fetch('http://localhost:3004/orchestrate', {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({ action: 'restart', target: name })
                    });
                    
                    if (response.ok) {
                        this.addLog(`Restarted ${name}`, 'info');
                    } else {
                        this.addLog(`Failed to restart ${name}`, 'error');
                    }
                } catch (error) {
                    this.addLog(`Error restarting ${name}: ${error.message}`, 'error');
                }
            }
        }

        // Global functions
        function clearLogs() {
            document.getElementById('logsContainer').innerHTML = '';
        }

        // Initialize dashboard
        const dashboard = new AutomationDashboard();
    </script>
</body>
</html> 