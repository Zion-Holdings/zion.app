<<<<<<< HEAD
const fs = require('fs');
const path = require('path');

const REPO_SLUG = 'Zion-Holdings/zion.app';
const WORKFLOWS_DIR = path.resolve(__dirname, '..', '.github', 'workflows');
const INDEX_PAGE = path.resolve(__dirname, '..', 'pages', 'index.tsx');

function toTitleCase(text) {
  return text
    .split(/[-_\s]+/)
    .map((w) => w.charAt(0).toUpperCase() + w.slice(1))
    .join(' ');
}

function readWorkflows() {
  try {
    const files = fs.readdirSync(WORKFLOWS_DIR);
    const autonomous = files
      .filter((f) => f.startsWith('autonomous-') && f.endsWith('.yml'))
      .map((f) => ({
        file: f,
        name: f.replace(/\.yml$/, ''),
      }))
      .map(({ file, name }) => {
        const core = name.replace(/^autonomous-/, '');
        const title = toTitleCase(core);
        return {
          type: 'external',
          href: `https://github.com/${REPO_SLUG}/actions/workflows/${file}`,
          label: `${title} — run / view`,
        };
      })
      .sort((a, b) => a.label.localeCompare(b.label));
    return autonomous;
  } catch (e) {
    return [];
  }
}

function fileExists(p) {
  try {
    fs.accessSync(p, fs.constants.F_OK);
    return true;
  } catch (_) {
    return false;
  }
}

function discoverInternalPages() {
  const root = path.resolve(__dirname, '..', 'pages');
  const internal = [];
  const candidates = [
    { href: '/automation', label: 'Automation Hub — live agents & reports', check: path.join(root, 'automation', 'index.tsx') },
    { href: '/newsroom', label: 'Newsroom — latest autonomous updates', check: path.join(root, 'newsroom.tsx') },
    { href: '/site-health', label: 'Site Health — audits & insights', check: path.join(root, 'site-health.tsx') },
  ];
  for (const c of candidates) {
    if (fileExists(c.check)) internal.push({ type: 'internal', href: c.href, label: c.label });
  }
  return internal;
}

function buildItems() {
  const internal = discoverInternalPages();
  const workflows = readWorkflows();

  const curated = [
    // Prefer a small, high-signal set for the homepage
    ...internal,
    // Pick a few noteworthy workflows by friendly name if present
  ];

  // Choose top workflows by a preferred order if they exist
  const prefer = [
    'Quick Fixes',
    'Deep Maintenance',
    'Marketing Seo',
    'Content Curation',
    'Deps Upgrade',
    'Cloud',
  ];

  const preferred = [];
  for (const p of prefer) {
    const idx = workflows.findIndex((w) => w.label.toLowerCase().startsWith(p.toLowerCase()))
      ;
    if (idx !== -1) {
      preferred.push(workflows[idx]);
    }
  }

  // Fill remaining up to max items
  const MAX_ITEMS = 10;
  const used = new Set(preferred.map((i) => i.href));
  const remaining = workflows.filter((w) => !used.has(w.href));
  const picked = [...curated, ...preferred, ...remaining].slice(0, MAX_ITEMS);
  return picked;
}

function generateBlock(items) {
  const lines = [];
  lines.push('<section className="mx-auto max-w-7xl px-6 pb-16">');
  lines.push('  <h2 className="text-center text-2xl font-bold tracking-wide text-white/90">Explore more</h2>');
  lines.push('  <div className="mt-6 grid grid-cols-1 gap-4 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4">');
  lines.push('');

  for (const item of items) {
    if (item.type === 'internal') {
      lines.push(`            <Link href="${item.href}"><a className="bg-white/5 hover:bg-white/10 rounded-lg p-4 transition-colors border border-white/10"><span className="text-white/90">${item.label}</span></a></Link>`);
      lines.push('  ');
      lines.push('');
    } else {
      lines.push(`            <a href="${item.href}" target="_blank" rel="noopener" className="bg-white/5 hover:bg-white/10 rounded-lg p-4 transition-colors border border-white/10"><span className="text-white/90">${item.label}</span></a>`);
      lines.push('  ');
      lines.push('');
    }
  }

  lines.push('  </div>');
  lines.push('</section>');
  return lines.join('\n');
}

function updateIndexPage() {
  const contents = fs.readFileSync(INDEX_PAGE, 'utf8');
  const startMarker = '{/* AUTO-GENERATED: HOME_UPDATER_START */}';
  const endMarker = '{/* AUTO-GENERATED: HOME_UPDATER_END */}';

  const startIdx = contents.indexOf(startMarker);
  const endIdx = contents.indexOf(endMarker);

  if (startIdx === -1 || endIdx === -1 || endIdx < startIdx) {
    console.error('Markers not found in pages/index.tsx');
    process.exit(1);
  }

  const before = contents.slice(0, startIdx + startMarker.length);
  const after = contents.slice(endIdx);

  const items = buildItems();
  const block = '\n' + generateBlock(items) + '\n';

  const updated = before + block + after;

  if (updated !== contents) {
    fs.writeFileSync(INDEX_PAGE, updated);
    console.log('Homepage updated successfully.');
  } else {
    console.log('No changes needed.');
  }
}

updateIndexPage();
=======
#!/usr/bin/env node
const fs = require('fs');
const path = require('path');

function readJSONSafely(p){ try { return JSON.parse(fs.readFileSync(p,'utf8')); } catch { return null; } }
function fileExists(p){ try { return fs.existsSync(p); } catch { return false; } }

function extractSignals(){
  const signals = [];
  // Docs signals
  const changelog = fileExists(path.join(process.cwd(),'docs','AUTONOMOUS_CHANGELOG.md'));
  const releaseNotes = fileExists(path.join(process.cwd(),'docs','RELEASE_NOTES.md'));
  if (changelog) signals.push('Auto-Changelog updated regularly');
  if (releaseNotes) signals.push('Release Notes generated from commits');
  // DAO presence
  if (fileExists(path.join(process.cwd(),'contracts','ZionGovernor.sol'))) signals.push('On-chain Governance (DAO) ready');
  // Automations count
  const automationDir = path.join(process.cwd(),'automation');
  if (fileExists(automationDir)) {
    const files = fs.readdirSync(automationDir).filter(f=>/\.(cjs|js)$/.test(f));
    signals.push(`Autonomous agents: ${files.length}+`);
  }
  return signals;
}

function buildContent(signals){
  const bullets = signals.map(s=>`<li>${s}</li>`).join('\n          ');
  return `      <div>
        <h1 className="text-3xl font-bold">Zion Autonomous Cloud</h1>
        <p className="text-gray-600 mt-2">Always-on, intelligent automations running in the cloud. No human intervention. Changes sync back to the repo automatically.</p>
      </div>

      <div className="grid md:grid-cols-2 gap-4">
        <a href="/docs/automation#infinite-loop">
          <div className="border rounded p-4 hover:bg-gray-50 cursor-pointer">
            <div className="font-semibold">Autonomous Improvement</div>
            <div className="text-sm text-gray-600">Continuous code, UX, and content evolution in the cloud</div>
          </div>
        </a>
        <a href="/dao">
          <div className="border rounded p-4 hover:bg-gray-50 cursor-pointer">
            <div className="font-semibold">Governance (DAO)</div>
            <div className="text-sm text-gray-600">On-chain proposals, voting, and timelock execution</div>
          </div>
        </a>
        <a href="/docs/automation#ui-evolution">
          <div className="border rounded p-4 hover:bg-gray-50 cursor-pointer">
            <div className="font-semibold">UI Evolution</div>
            <div className="text-sm text-gray-600">AI-driven UI beautification and navigation improvements</div>
          </div>
        </a>
        <a href="/blog">
          <div className="border rounded p-4 hover:bg-gray-50 cursor-pointer">
            <div className="font-semibold">SEO & Content</div>
            <div className="text-sm text-gray-600">Automated content generation and SEO optimization</div>
          </div>
        </a>
        <a href="/docs/automation#health">
          <div className="border rounded p-4 hover:bg-gray-50 cursor-pointer">
            <div className="font-semibold">Security & Health</div>
            <div className="text-sm text-gray-600">Self-healing, security scans, and link/site maintenance</div>
          </div>
        </a>
      </div>

      <div className="space-y-2">
        <h2 className="text-xl font-semibold">Live capabilities</h2>
        <ul className="list-disc ml-6 text-sm text-gray-700 space-y-1">
          ${bullets}
        </ul>
      </div>

      <div className="space-y-2">
        <h2 className="text-xl font-semibold">Triggers</h2>
        <ul className="list-disc ml-6 text-sm text-gray-700 space-y-1">
          <li>GitHub Actions schedules run multiple times per hour</li>
          <li>Each successful run auto-commits improvements</li>
        </ul>
      </div>

      <div>
        <a href="/blog"><span className="px-3 py-2 rounded bg-blue-600 text-white cursor-pointer">See Latest Changes</span></a>
      </div>`;
}

(function main(){
  const file = path.join(process.cwd(),'pages','index.tsx');
  if (!fileExists(file)) { console.log('Homepage not found'); process.exit(0); }
  const src = fs.readFileSync(file,'utf8');
  const start = src.indexOf('{/* AUTO:START');
  const end = src.indexOf('AUTO:END */}');
  if (start === -1 || end === -1) { console.log('AUTO markers not found'); process.exit(0); }

  const signals = extractSignals();
  const content = buildContent(signals);

  const before = src.slice(0, start);
  const after = src.slice(end + 'AUTO:END */}'.length);
  const updated = before + '{/* AUTO:START - DO NOT EDIT BELOW. This section is managed by automation/homepage-auto-updater.cjs */}\n' + content + '\n      {/* AUTO:END - DO NOT EDIT ABOVE */}' + after;

  if (updated !== src) {
    fs.writeFileSync(file, updated);
    console.log('Homepage updated by automation');
  } else {
    console.log('No homepage changes');
  }
})();
>>>>>>> origin/cursor/build-categorized-ziongpt-prompt-library-535a
