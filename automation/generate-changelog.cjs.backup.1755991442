#!/usr/bin/env node
<<<<<<< HEAD
=======

>>>>>>> origin/cursor/display-ai-job-and-talent-matches-e6f8
const { execSync } = require('child_process');
const fs = require('fs');
const path = require('path');

<<<<<<< HEAD
function getRecentCommits(limit = 50) {
  const format = `%h%x09%ad%x09%s%x09%an`;
  const log = execSync(`git log -n ${limit} --date=short --pretty=format:"${format}"`, { encoding: 'utf8' });
  return log.split('\n').filter(Boolean).map((line) => {
    const [hash, date, subject, author] = line.split('\t');
    return { hash, date, subject, author };
  });
}

function buildMarkdown(commits) {
  const today = new Date().toISOString().slice(0, 10);
  const lines = [];
  lines.push(`\n## ${today}`);
  for (const c of commits) {
    lines.push(`- ${c.subject} ([${c.hash}]) â€” ${c.author}`);
  }
  return lines.join('\n') + '\n';
}

(function main() {
  const commits = getRecentCommits(60);
  const md = buildMarkdown(commits);
  const changelogPath = path.join(process.cwd(), 'CHANGELOG.md');
  let existing = fs.existsSync(changelogPath) ? fs.readFileSync(changelogPath, 'utf8') : '# Changelog\n';
  if (!existing.includes(md.trim())) {
    existing += md;
    fs.writeFileSync(changelogPath, existing, 'utf8');
    console.log('[changelog] updated CHANGELOG.md');
  } else {
    console.log('[changelog] no changes');
  }
})();
=======
function sh(cmd) {
  try {
    return execSync(cmd, { encoding: 'utf8' }).trim();
  } catch (e) {
    return '';
  }
}

function getCommits() {
  // Last 200 commits on current branch
  const raw = sh('git log -n 200 --pretty=format:%H%x09%ad%x09%s --date=short');
  return raw
    .split('\n')
    .filter(Boolean)
    .map((line) => {
      const [hash, date, ...rest] = line.split('\t');
      return { hash, date, subject: rest.join('\t') };
    });
}

function formatChangelog(commits) {
  const byDate = new Map();
  for (const c of commits) {
    if (!byDate.has(c.date)) byDate.set(c.date, []);
    byDate.get(c.date).push(c);
  }
  const days = Array.from(byDate.keys()).sort((a, b) => (a < b ? 1 : -1));
  let out = '# Changelog\n\n';
  out += `Generated on ${new Date().toISOString()}\n\n`;
  for (const day of days) {
    out += `## ${day}\n`;
    const items = byDate.get(day).slice(0, 30);
    for (const c of items) {
      const short = c.hash.slice(0, 7);
      out += `- ${c.subject} (${short})\n`;
    }
    out += '\n';
  }
  return out;
}

function main() {
  const commits = getCommits();
  if (!commits.length) return;
  const content = formatChangelog(commits);
  const file = path.join(process.cwd(), 'CHANGELOG.md');
  fs.writeFileSync(file, content);
  console.log(`Wrote ${file}`);
}

main();
>>>>>>> origin/cursor/display-ai-job-and-talent-matches-e6f8
