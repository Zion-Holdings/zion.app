[build]
  # Use `npm ci` for deterministic installs
  # Generate Prisma client before building to ensure models are up to date
  command = "npm run build"
  publish = ".next"

# Secrets scanning configuration
[build.processing.secrets]
  enabled = true
  # Ignore certain paths that might contain placeholder values
  omit_paths = [
    ".netlify/.next/cache/**",
    "docs/**",
    "scripts/**",
    ".next/**",
    ".netlify/.next/static/**"
  ]
  # Ignore public environment variables that are intentionally in client code
  omit_keys = [
    "NEXT_PUBLIC_CLOUDINARY_CLOUD_NAME",
    "NEXT_PUBLIC_*"
  ]

[build.environment]
  NODE_OPTIONS = "--max_old_space_size=4096"
  NPM_FLAGS = "--prefer-offline --legacy-peer-deps"
  NODE_VERSION = "20"
  
  # ========================================
  # AUTH0 AUTHENTICATION CONFIGURATION
  # ========================================
  # Auth0 handles all authentication (login, signup, password reset, social login, etc.)
  # These variables MUST be set in Netlify UI with actual values from your Auth0 application
  # Get these from: https://manage.auth0.com/dashboard/applications/YOUR_APP_ID/settings
  
  # REQUIRED: Auth0 configuration
  # Generate AUTH0_SECRET with: openssl rand -hex 32
  AUTH0_SECRET = "your_auth0_secret_here_generate_with_openssl_rand_hex_32"
  AUTH0_BASE_URL = "https://your-domain.netlify.app"
  AUTH0_ISSUER_BASE_URL = "https://your-tenant.us.auth0.com"
  AUTH0_CLIENT_ID = "your_auth0_client_id_here"
  AUTH0_CLIENT_SECRET = "your_auth0_client_secret_here"
  
  # OPTIONAL: Auth0 API audience (if using Auth0 API)
  AUTH0_AUDIENCE = "https://your-api-identifier"
  
  # ========================================
  # MONITORING & ANALYTICS CONFIGURATION
  # ========================================
  # Sentry for error monitoring (RECOMMENDED for production)
  NEXT_PUBLIC_SENTRY_DSN = "your_sentry_dsn_here"
  NEXT_PUBLIC_SENTRY_ENVIRONMENT = "production"
  NEXT_PUBLIC_SENTRY_RELEASE = "1.0.0"
  
  # Analytics and monitoring
  NEXT_PUBLIC_GA_ID = "your_google_analytics_id_here"
  NEXT_PUBLIC_INTERCOM_APP_ID = "your_intercom_app_id_here"
  
  # ========================================
  # WALLET & WEB3 CONFIGURATION  
  # ========================================
  # Reown (WalletConnect) for wallet integration
  NEXT_PUBLIC_REOWN_PROJECT_ID = "your_reown_project_id_here"
  NEXT_PUBLIC_ALCHEMY_API_KEY = "your_alchemy_api_key_here"
  NEXT_PUBLIC_ZION_TOKEN_CONTRACT_ADDRESS = "your_token_contract_address_here"
  NEXT_PUBLIC_ZION_TOKEN_NETWORK_ID = "1"
  NEXT_PUBLIC_SNAPSHOT_SPACE_ID = "yourproject.eth"
  NEXT_PUBLIC_SNAPSHOT_HUB_URL = "https://hub.snapshot.org"
  
  # ========================================
  # PAYMENT PROCESSING CONFIGURATION
  # ========================================
  # Stripe payment processing
  NEXT_PUBLIC_STRIPE_PUBLISHABLE_KEY = "pk_live_your_stripe_publishable_key_here"
  STRIPE_SECRET_KEY = "sk_live_your_stripe_secret_key_here"
  STRIPE_WEBHOOK_SECRET = "whsec_your_stripe_webhook_secret_here"
  
  # ========================================
  # MEDIA & CONTENT CONFIGURATION
  # ========================================
  # Cloudinary for image management
  NEXT_PUBLIC_CLOUDINARY_CLOUD_NAME = "SET_IN_NETLIFY_UI"
  CLOUDINARY_API_KEY = "SET_IN_NETLIFY_UI"
  CLOUDINARY_API_SECRET = "SET_IN_NETLIFY_UI"
  
  # ========================================
  # COMMUNICATION CONFIGURATION
  # ========================================
  # Email configuration
  NEXT_PUBLIC_SUPPORT_EMAIL = "support@yourdomain.com"
  SENDGRID_API_KEY = "SG.your_sendgrid_api_key_here"
  
  # ========================================
  # APPLICATION CONFIGURATION
  # ========================================
  # Application URLs
  NEXT_PUBLIC_APP_URL = "https://your-domain.netlify.app"
  NEXT_PUBLIC_API_URL = "https://your-domain.netlify.app/api"
  
  # Feature flags
  NEXT_PUBLIC_ENABLE_ANALYTICS = "true"
  NEXT_PUBLIC_ENABLE_WALLET = "true"
  NEXT_PUBLIC_ENABLE_PAYMENTS = "true"
  
  # External APIs
  OPENAI_API_KEY = "SET_IN_NETLIFY_UI"
  EXAMPLE_API_URL = "https://api.example.com"

# Deploy contexts for different environments
[context.production.environment]
  AUTH0_BASE_URL = "https://yourdomain.com"
  NEXT_PUBLIC_SENTRY_ENVIRONMENT = "production"
  NEXT_PUBLIC_ENABLE_ANALYTICS = "true"

[context.deploy-preview.environment]
  AUTH0_BASE_URL = "https://deploy-preview-${REVIEW_ID}--your-site.netlify.app"
  NEXT_PUBLIC_SENTRY_ENVIRONMENT = "preview"
  NEXT_PUBLIC_ENABLE_ANALYTICS = "false"

[context.branch-deploy.environment]
  AUTH0_BASE_URL = "https://${BRANCH}--your-site.netlify.app"
  NEXT_PUBLIC_SENTRY_ENVIRONMENT = "staging"
  NEXT_PUBLIC_ENABLE_ANALYTICS = "false"

# Redirects for Single Page Application
[[redirects]]
  from = "/*"
  to = "/index.html"
  status = 200
  conditions = {Role = ["admin"]}

# API redirects
[[redirects]]
  from = "/api/*"
  to = "/.netlify/functions/:splat"
  status = 200

# Headers for security
[[headers]]
  for = "/*"
  [headers.values]
    X-Frame-Options = "DENY"
    X-XSS-Protection = "1; mode=block"
    X-Content-Type-Options = "nosniff"
    Referrer-Policy = "strict-origin-when-cross-origin"
    Permissions-Policy = "camera=(), microphone=(), geolocation=()"

[functions.environment]
  SENTRY_LOG_LEVEL = "debug"

[functions.sentryDsnCheckCron]
  schedule = "@daily"

[functions.healthCheckCron]
  schedule = "*/5 * * * *"

[[plugins]]
  package = "@netlify/plugin-nextjs"

