#!/usr/bin/env node
'use strict';

const fs = require('fs');
const path = require('path');

function ensureDir(dirPath) {
	if (!fs.existsSync(dirPath)) {
		fs.mkdirSync(dirPath, { recursive: true });
	}
}

(function main() {
	const outDir = path.join(process.cwd(), 'public', 'reports', 'netlify');
	ensureDir(outDir);
	const manifestPath = path.join(outDir, 'functions-manifest.json');
	const manifest = {
		generatedAt: new Date().toISOString(),
		functions: [],
		note: 'Placeholder manifest generated by automation to satisfy build pre-step.'
	};
	try {
		fs.writeFileSync(manifestPath, JSON.stringify(manifest, null, 2));
		console.log(`[netlify:manifest] Wrote placeholder manifest to ${manifestPath}`);
		process.exit(0);
	} catch (err) {
		console.error('[netlify:manifest] Failed to write manifest:', err.message);
		// Do not block builds on this step; exit 0 intentionally
		process.exit(0);
	}
})();
