name: CI
# Continuous Integration pipeline

on:
  push:
    branches: [main]
  pull_request:
  workflow_dispatch:

jobs:
  build:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
        # Setup repository
      - id: setup-node
        uses: actions/setup-node@v4
        with:
          node-version: 20
          cache: 'npm'
      - run: npm ci
        if: steps.setup-node.outputs.cache-hit != 'true'
        # Lint codebase
      - run: npm run lint
        # Ensure Prettier formatting
      - run: npm run format -- --check
        # Execute unit tests
      - run: npm test
      - run: npx vitest run --coverage
      - run: npm run cypress:run
        # Build application
      - run: npm run build
        # Scan dependencies for vulnerabilities
      - run: npm run audit
