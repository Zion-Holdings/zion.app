---
name: "‚úÖ Workflow Validator"
on:
  push:
    branches:
    - main
    - develop
    paths:
    - .github/workflows/**
  pull_request:
    branches:
    - main
    - develop
    paths:
    - .github/workflows/**
  workflow_dispatch: {}
permissions:
  contents: read
  actions: read
concurrency:
  group: workflow-${{ github.ref }}
  cancel-in-progress: false
jobs:
  validate:
    name: Validate Workflows
    runs-on: ubuntu-latest
    timeout-minutes: 10
    steps:
      - name: Checkout repository
        uses: actions/checkout@v4
        with:
          fetch-depth: 0
      - name: Setup Python
        uses: actions/setup-python@v4
        with:
        python-version: '3.11'
      - name: Install dependencies
        run: pip install pyyaml
      - name: Validate workflow syntax
        run: |
        echo "üîç Validating workflow syntax..."
        
        # Find all workflow files
        workflow_files=$(find .github/workflows -name "*.yml" -o -name "*.yaml")
        total_files=$(echo "$workflow_files" | wc -l)
        
        echo "üìÅ Found $total_files workflow files"
        
        # Validate each file
        invalid_files=()
        valid_count=0
        
        for file in $workflow_files; do
          echo "  üîç Checking: $file"
          
          if python3 -c "import yaml; yaml.safe_load(open('$file', 'r'))" 2>/dev/null; then
            echo "    ‚úÖ Valid"
            valid_count=$((valid_count + 1))
          else
            echo "    ‚ùå Invalid"
            invalid_files+=("$file")
          fi
        done
        
        # Summary
        echo ""
        echo "üìä Validation Summary:"
        echo "  Total files: $total_files"
        echo "  Valid files: $valid_count"
        echo "  Invalid files: ${#invalid_files[@]}"
        
        if [ ${#invalid_files[@]} -gt 0 ]; then
          echo ""
          echo "‚ùå Invalid workflows found:"
          for file in "${invalid_files[@]}"; do
            echo "  - $file"
          done
          echo ""
          echo "üö® Please fix these workflow files before merging"
          exit 1
        else
          echo ""
          echo "‚úÖ All workflows are valid!"
        fi
