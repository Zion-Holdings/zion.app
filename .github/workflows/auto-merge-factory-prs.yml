name: Auto-merge factory PRs

on:
  pull_request:
    types: [opened, synchronize, reopened]
    branches:
      - main

permissions:
  contents: write
  pull-requests: write

jobs:
  automerge:
    if: >-
      ${{ ! (vars.FACTORY_ENABLED && vars.FACTORY_ENABLED == 'false') &&
          (startsWith(github.head_ref, 'factory/state-epoch-') ||
           startsWith(github.head_ref, 'factory/policy-') ||
           startsWith(github.head_ref, 'agents/agent-')) }}
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      - name: Enable auto-merge
        uses: peter-evans/enable-pull-request-automerge@v3
        with:
          token: ${{ secrets.GITHUB_TOKEN }}
          merge-method: squash