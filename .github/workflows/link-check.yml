name: Link Check

on:
  pull_request:
  schedule:
    - cron: '15 2 * * *'
  workflow_dispatch:

permissions:
  contents: read
  issues: write

jobs:
  lychee:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout
        uses: actions/checkout@v4
      - name: Run lychee link checker
        id: lychee
        uses: lycheeverse/lychee-action@v1
        with:
          args: --verbose --no-progress --exclude-mail --format markdown --output ./lychee/out.md .
      - name: Upload report artifact
        if: always()
        uses: actions/upload-artifact@v4
        with:
          name: lychee-report
          path: ./lychee/out.md
      - name: Create issue on failure (scheduled only)
        if: failure() && github.event_name == 'schedule'
        uses: peter-evans/create-issue-from-file@v5
        with:
          title: 'Broken links detected'
          content-filepath: ./lychee/out.md
          labels: 'automation, bug'