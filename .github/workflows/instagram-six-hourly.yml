name: Instagram Six-Hourly Posting
on:
  workflow_dispatch: {}
  schedule:
  - cron: 0 2 * * *
jobs:
  instagram_post:
    runs-on: ubuntu-latest
    steps:
    - name: Checkout
      uses: actions/checkout@v4
    - name: Setup Node.js
      uses: actions/setup-node@v4
      with:
        node-version: 20
        cache: npm
    - name: Install dependencies
      run: npm ci
    - name: Run Instagram marketing orchestrator (single cycle)
      env:
        IG_USER_ID: ${{ secrets.IG_USER_ID }}
        IG_BUSINESS_ACCOUNT_ID: ${{ secrets.IG_BUSINESS_ACCOUNT_ID }}
        IG_ACCESS_TOKEN: ${{ secrets.IG_ACCESS_TOKEN }}
        APP_MARKETING_URL: https://ziontechgroup.com
        IG_IMAGE_URL: ${{ secrets.IG_IMAGE_URL }}
      run: node automation/instagram-marketing-orchestrator.cjs once | cat
    - name: Upload Instagram logs
      if: always()
      uses: actions/upload-artifact@v4
      with:
        name: instagram-logs
        path: 'automation/logs/**/*.log

          '
        if-no-files-found: ignore
        retention-days: 7
    timeout-minutes: 30
permissions:
  contents: read
  actions: read
concurrency:
  group: instagram-six-hourly.yml-${{ github.ref }}
  cancel-in-progress: true
