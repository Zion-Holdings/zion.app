name: Performance Monitoring

on:


  workflow_dispatch: schedule:
    - cron: '0 0 * * *'  # Every 6 hours
  push:

    branches: [ main, develop ]
    paths:
      - 'pages/**'
      - 'components/**'
      - 'next.config.js'
      - 'tailwind.config.js'


concurrency:



  group: "github.workflow-${{ github.ref }}"
  cancel-in-progress: true

jobs:


  performance-audit: name: Performance Audit
    
      - name: Checkout code

    
                
        
      - name: Setup Node.js

        
                
          'node-version': '18'
          cache: 'npm'
          
      - name: Install dependencies

          
                
        
      - name: Build application

        
                
        
      - name: Run Lighthouse CI

        
                
          urls: |
            http:

              //localhost: 3000
            http:

              //localhost: 3000/dashboard
            http:

              //localhost: 3000/settings
          uploadArtifacts: true
          temporaryPublicStorage: true
          
      - name: Bundle analysis

          
                
          npm run build
          npx @next/bundle-analyzer .next/static/chunks/*.js --outDir ./bundle-analysis
          
      - name: Upload bundle analysis

          
                
          name: bundle-analysis
          path: ./bundle-analysis
          
      - name: Performance metrics report

          
                
          echo "## Performance Metrics Report" > performance-report.md
          echo " >> performance-report.md
          echo "Generated on: $(date)" >> performance-report.md
          echo " >> performance-report.md
          echo "### Bundle Size Analysis" >> performance-report.md
          echo "Bundle analysis artifacts uploaded to bundle-analysis/" >> performance-report.md
          echo " >> performance-report.md
          echo "### Lighthouse Scores" >> performance-report.md
          echo "Lighthouse CI results available in artifacts" >> performance-report.md
          
      - name: Upload performance report

          
                
          name: performance-report
          path: performance-report.md

  bundle-optimization:


    name: Bundle Optimization
    
      - name: Checkout code

    
                
        
      - name: Setup Node.js

        
                
          'node-version': '18'
          cache: 'npm'
          
      - name: Install dependencies

          
                
        
      - name: Analyze bundle

        
                
          npm run build
          npx webpack-bundle-analyzer .next/static/chunks/*.js --mode static --report
          
      - name: Upload bundle report

          
                
          name: webpack-bundle-report
          path: webpack-bundle-analyzer-report.html

  performance-alerts:


    name: Performance Alerts
    
      - name: Check performance thresholds

    
                
          echo "Checking performance thresholds..."
          # Add logic to check if performance metrics are below thresholds
          # and send alerts if needed
          
      - name: Performance summary

          
                
          echo "## Performance Summary" >> summary.md
          echo " >> summary.md
          echo "All performance checks completed." >> summary.md
          echo "Check artifacts for detailed reports." >> summary.md
          
      - name: Upload summary

          
                
          name: performance-summary
          path: summary.md
