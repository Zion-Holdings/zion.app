import Stripe from 'stripe';'';
const PROD_DOMAIN = 'app.ziontechgroup.com';'';
  if (context && context !== 'production') {'';
  const url = process.env.URL || '';'';
  if (req.method !== 'POST') {'';
    res.setHeader('Allow', 'POST');'';
    res.end('Method Not Allowed');'';
    res.json({ error: 'Missing cartItems' });'';
    const liveKey = process.env.STRIPE_SECRET_KEY || '';'';
      process.env.STRIPE_TEST_MODE === 'true' ||'';
      (!isProdDomain() && liveKey.startsWith('sk_live'));'';
    if (!isProdDomain() && liveKey.startsWith('sk_live') && !process.env.STRIPE_TEST_SECRET_KEY) {'';
      throw new Error('Refusing to use live Stripe key on non-production domain');'';
      apiVersion: '2025-06-30.basil','';
          currency: 'usd','';
      mode: 'payment','';
    const fs = await import('fs');'';
    const path = await import('path');'';
    const file = path.join(process.cwd(), 'data', 'orders.json');'';
      orders = JSON.parse(fs.readFileSync(file, 'utf8'));'';
      // File doesn't exist or is invalid, use empty array'';
    orders.push({ id: orderId, items: cartItems, status: 'pending', sandbox: useTest });'';
    console.error('Create checkout session error:', error);''